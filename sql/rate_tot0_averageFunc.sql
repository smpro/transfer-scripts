CREATE OR REPLACE FUNCTION RATE2T_AVERAGE (RUNNUMBER_IN NUMBER)
  RETURN CHAR IS
  CURSOR NUM IS
  SELECT
  DECODE(time_difference,0,-999,
         ROUND(sum_filesize / time_difference,2)) AS VALUE
  FROM
  (SELECT SUM(FILESIZE)/1048576 sum_filesize
   FROM FILES_INFO WHERE RUNNUMBER = RUNNUMBER_IN AND state>10),
  (SELECT INT_TO_SECONDS(MAX(COPIED_TIME) - MIN(NEW_TIME)) time_difference
   FROM FILES_INFO WHERE RUNNUMBER = RUNNUMBER_IN AND state>10);
  TOTAL NUMBER;
  BEGIN
  FOR X IN NUM LOOP
  TOTAL := X.VALUE;
  END LOOP;
  RETURN TO_CHAR(TOTAL);
END RATE2T_AVERAGE;

/
