CREATE OR REPLACE FUNCTION RATE2D_AVERAGE (RUNNUMBER_IN NUMBER)
  RETURN CHAR IS
  CURSOR NUM IS
  SELECT
  DECODE(time_difference,0,-999,
         ROUND(sum_filesize / time_difference,2)) AS VALUE
  FROM
  (SELECT SUM(FILESIZE)/1048576 sum_filesize
   FROM FILES_INFO WHERE RUNNUMBER = RUNNUMBER_IN AND STATE>0),
  (SELECT INT_TO_SECONDS(MAX(INJECTED_TIME) - MIN(CREATED_TIME)) time_difference
   FROM FILES_INFO WHERE RUNNUMBER = RUNNUMBER_IN AND STATE>0);
  TOTAL NUMBER;
  BEGIN
  FOR X IN NUM LOOP
  TOTAL := X.VALUE;
  END LOOP;
  RETURN TO_CHAR(TOTAL);
END RATE2D_AVERAGE;

/
